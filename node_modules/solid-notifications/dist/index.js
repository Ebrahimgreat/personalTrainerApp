import {template,delegateEvents,createComponent,setAttribute,insert,effect,style,addEventListener,use,className}from'solid-js/web';import {createContext,mergeProps,splitProps,onMount,onCleanup,useContext,createEffect,on,batch,For,Show,createSignal}from'solid-js';import {createStore,createMutable}from'solid-js/store';var de=template('<button aria-label="Close notification"><svg aria-hidden=true xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"width=100% height=100%><path fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2.5 d="m7 7l10 10M7 17L17 7">'),fe=template("<div role=progressbar data-role=progress>"),ce=template('<svg class=sn-icon xmlns=http://www.w3.org/2000/svg viewBox="0 0 52 52"><circle stroke=currentColor cx=26 cy=26 r=25 fill=none></circle><path fill=none d="M14.1 27.2l7.1 7.2 16.7-16.8">'),le=template('<svg class=sn-icon xmlns=http://www.w3.org/2000/svg viewBox="0 0 52 52"><circle stroke=currentColor cx=26 cy=26 r=25 fill=none></circle><path fill=none d="M14.1 14.1l23.8 23.8 m0,-23.8 l-23.8,23.8">'),ge=template('<svg class=sn-icon xmlns=http://www.w3.org/2000/svg viewBox="0 0 52 52"><circle stroke=currentColor cx=26 cy=26 r=25 fill=none></circle><path fill=none d="M26 9v20M26 34v8">'),he=template('<svg class=sn-icon xmlns=http://www.w3.org/2000/svg viewBox="0 0 52 52"><circle stroke=currentColor cx=26 cy=26 r=25 fill=none></circle><path fill=none d="M26 9v8M26 22v22">'),me=template('<div class="sn-icon sn-icon-loading">');function E(t,e){if(!t)return;let r=e.rendered.find(n=>n.toastConfig.id===t);return r||e.queued.find(n=>n.toastConfig.id===t)}function x(t,e,r){return r||(!e||e==="__default"?`toast-${t++}`:`${e}:toast-${t}`)}function _(t){return typeof t.toastConfig.content=="function"?t.toastConfig.content(t):t.toastConfig.content||`\u{1F35E} Toast "${t.toastConfig.id}" ready to serve!`}function p(t,e){let r=e.toastConfig[t];return typeof r=="function"?r({theme:e.toastConfig.theme,type:e.toastConfig.type}):r}function L(t){switch(t){case "left":return "start";case "right":return "end";case "center":return "center"}}function X(t){if(!t.toasterConfig.reverseToastOrder)return t.toasterConfig.offsetY;let e=t.rendered[0];return e?e.offset+e.ref?.clientHeight+t.toasterConfig.gutter:t.toasterConfig.offsetY}function P(t,e){let r=n=>n&&typeof n=="object"&&n.constructor===Object;return Array.isArray(t)?e:r(t)&&r(e)?Object.keys(e).reduce((n,o)=>(typeof o!="symbol"&&(n[o]=P(t[o],e[o])),n),{...t}):e}function b(t){if(!t)return {};let e=["positionX","positionY","offsetX","offsetY","gutter","limit","toasterStyle","reverseToastOrder","pauseOnWindowInactive","renderOnWindowInactive"];return Object.fromEntries(Object.entries(t).filter(([n])=>!e.includes(n)))}function j(t){let e=t.toastConfig;switch(t.state){case "entering":if(e.onEnter)return e.onEnter;case "idle":if(e.onIdle)return e.onIdle;case "exiting":if(e.onExit)return e.onExit;default:return `sn-state-${e.positionX}-${e.positionY}-${t.state}`}}function B(t,e){let[r,n]=createSignal(0),o=t?.toastConfig.duration,f=performance.now(),d=0,c=false,v=()=>{if(!o||!e||c)return;d=performance.now()-f;let w=Math.min(Math.round(d/o*1e4)/100,100);if(n(w),w>=100)return c=true,e();requestAnimationFrame(v);},s=()=>{c=false,f=performance.now()-d,requestAnimationFrame(v),t&&(t.isPaused=false);},a=()=>{c=true,t&&(t.isPaused=true);},i=l=>{u(),o=l,f=performance.now();},u=()=>{c=true,n(0),d=0,t&&(t.isPaused=true);};return {progress:r,play:s,pause:a,update:i,reset:u}}function O(t){return {pause:()=>{t.progressManager.pause(),t.isPausedByUser=true;},play:()=>{t.progressManager.play(),t.isPausedByUser=false;},reset:()=>{t.progressManager.reset(),t.isPausedByUser=true;},progress:t.progressManager.progress}}function H(t){let e=0,r=0;return {handleDragStart:d=>{t.ref&&t.toastConfig.dragToDismiss&&(e=d.touches[0].clientX,t.ref.style.transition="none",t.progressManager.pause());},handleDragMove:d=>{t.ref&&t.toastConfig.dragToDismiss&&(r=d.touches[0].clientX-e,t.ref.style.transform=`translateX(${r}px)`);},handleDragEnd:()=>{t.ref&&t.toastConfig.dragToDismiss&&(Math.abs(r)>t.toastConfig.dragTreshold?(t.ref.style.transition="all 0.3s ease",t.ref.style.transform=`translateX(${r>0?"100%":"-100%"})`,t.ref.style.opacity="0",t.dismiss(undefined,false)):(t.progressManager.play(),t.ref.style.transition="all 0.3s ease",t.ref.style.transform="translateX(0)"),e=0,r=0);}}}function Q(t,e){!e.toastConfig.dismissOnClick||t.target instanceof HTMLElement&&t.target.closest("a, button, input, select, textarea")||e.dismiss();}function N(t){!t.toastConfig.pauseOnHover||t.store.isWindowBlurred&&t.toastConfig.pauseOnWindowInactive||t.isPausedByUser||t.progressManager.pause();}function U(t){!t.toastConfig.pauseOnHover||t.ref?.contains(document.activeElement)||t.store.isWindowBlurred&&t.toastConfig.pauseOnWindowInactive||t.isPausedByUser||t.progressManager.play();}function S(t){if(!(typeof document>"u")&&t.altKey&&t.key.toLowerCase()==="t"){t.preventDefault();let e=Array.from(document.querySelectorAll('[data-role="toast"]'));if(e.length===0)return;let n=(e.findIndex(o=>document.activeElement===o)+1)%e.length;e[n].focus(),e[n].setAttribute("data-keyboard-focused","true");}}function Y(t,e){t.ref&&(t.ref.contains(e.relatedTarget)||(t.ref.removeAttribute("data-keyboard-focused"),!t.isPausedByUser&&t.progressManager.play()));}function z(t){return t.toastConfig.dismissOnClick||!t.toastConfig.showDismissButton?null:(()=>{var e=de();return e.$$click=()=>t.dismiss(),effect(r=>{var n=p("dismissButtonClass",t),o=p("dismissButtonStyle",t);return n!==r.e&&className(e,r.e=n),r.t=style(e,o,r.t),r},{e:undefined,t:undefined}),e})()}function R(t){return !t.toastConfig.showProgressBar||!t.toastConfig.duration?null:(()=>{var e=fe();return effect(r=>{var n=p("progressBarClass",t),o={transform:`scaleX(${(100-t.progressManager?.progress())/100})`,"transform-origin":"left",...p("progressBarStyle",t)};return n!==r.e&&className(e,r.e=n),r.t=style(e,o,r.t),r},{e:undefined,t:undefined}),e})()}function K(t){let e=t.toastConfig;if(!e.showIcon)return null;if(e.icon)return typeof e.icon=="function"?e.icon({theme:e.theme,type:e.type}):e.icon;switch(e.type){case "success":return ce();case "error":return le();case "warning":return ge();case "info":return he();case "loading":return me();default:return null}}delegateEvents(["click"]);var ye=template("<div>"),Te=template("<div data-role=toast tabindex=0>"),D=class{dragManager=H(this);ref=null;state="entering";isPaused=true;isPausedByUser=false;offset=0;constructor(e){return this.store=e.store,this.setStore=e.setStore,this.ownProperties=new Set(Object.keys(e.toastConfig)),this.toastConfig=P(e.store.toasterConfig,e.toastConfig),this.offset=X(e.store),this.progressManager=B(),createMutable(this)}init(){this.progressManager=B(this,()=>this.dismiss("__expired"));let e=this.store.toasterConfig.limit&&this.store.rendered.length>=this.store.toasterConfig.limit,r=this.store.isWindowBlurred&&!this.store.toasterConfig.renderOnWindowInactive;if(e||r)return this.setStore("queued",[...this.store.queued,this]);this.setStore("rendered",[this,...this.store.rendered]);}lifecycle(){!this.renderedAt||(this.state!=="idle"&&setTimeout(()=>this.state="idle",this.toastConfig.enterDuration),this.isPausedByUser)||this.store.isWindowBlurred&&this.toastConfig.pauseOnWindowInactive||this.ref?.contains(document.activeElement)||this.progressManager.play();}update(e){Object.keys(e).forEach(r=>this.ownProperties.add(r)),Object.assign(this.toastConfig,e),this.toastConfig.updateCallback?.(),this.progressManager.update(this.toastConfig.duration),this.lifecycle();}dismiss(e,r=true){if(this.toastConfig.exitCallback){switch(e){case "__expired":e=false;break;case undefined:e=true;break;default:e=e;break}this.toastConfig.exitCallback?.(e);}r&&(this.state="exiting"),setTimeout(()=>{batch(()=>{this.setStore("rendered",n=>n.filter(o=>o.toastConfig.id!==this.toastConfig.id)),this.setStore("queued",n=>n.filter(o=>o.toastConfig.id!==this.toastConfig.id));});},this.toastConfig.exitDuration);}remove(){batch(()=>{this.setStore("rendered",e=>e.filter(r=>r.toastConfig.id!==this.toastConfig.id)),this.setStore("queued",e=>e.filter(r=>r.toastConfig.id!==this.toastConfig.id));});}patch(e){let r=Object.fromEntries(Object.entries(e).filter(([n])=>!this.ownProperties.has(n)));Object.assign(this.toastConfig,r);}render(){onMount(()=>{this.renderedAt=Date.now(),this.toastConfig.enterCallback?.(),this.lifecycle();});let e=this;return (()=>{var r=Te();return r.$$keydown=n=>n.key==="Escape"&&e.dismiss(),r.$$focusout=n=>Y(e,n),addEventListener(r,"focusin",e.progressManager.pause,true),addEventListener(r,"touchend",e.dragManager.handleDragEnd,true),addEventListener(r,"touchmove",e.dragManager.handleDragMove,true),addEventListener(r,"touchstart",e.dragManager.handleDragStart,true),addEventListener(r,"mouseleave",U.bind(null,e)),addEventListener(r,"mouseenter",N.bind(null,e)),r.$$click=n=>Q(n,e),use(n=>e.ref=n,r),insert(r,createComponent(Show,{get fallback(){return _(e)},get when(){return e.toastConfig.contentType==="static"},get children(){var n=ye();return insert(n,()=>K(e),null),insert(n,()=>_(e),null),insert(n,()=>z(e),null),insert(n,()=>R(e),null),effect(o=>{var f=p("class",e),d=p("style",e);return f!==o.e&&className(n,o.e=f),o.t=style(n,d,o.t),o},{e:undefined,t:undefined}),n}})),effect(n=>{var o=e.toastConfig.id,f=e.toastConfig.role,d=e.toastConfig.ariaLive,c=`${p("wrapperClass",e)} sn-theme-${e.toastConfig.theme} sn-type-${e.toastConfig.type} ${j(e)}`.trim(),v={...p("wrapperStyle",e),[e.store.toasterConfig.positionX]:`${e.store.toasterConfig.offsetX}px`,[e.store.toasterConfig.positionY]:`${e.offset}px`};return o!==n.e&&setAttribute(r,"id",n.e=o),f!==n.t&&setAttribute(r,"role",n.t=f),d!==n.a&&setAttribute(r,"aria-live",n.a=d),c!==n.o&&className(r,n.o=c),n.i=style(r,v,n.i),n},{e:undefined,t:undefined,a:undefined,o:undefined,i:undefined}),r})()}},I=D;delegateEvents(["click","touchstart","touchmove","touchend","focusin","focusout","keydown"]);function Ie(t,{toasterId:e,store:r,setStore:n,counter:o}){if(e==="__default")throw new Error('Toaster with toasterId "__default" is reserved and cannot be used.');if(!e)if(t.size===0)e="__default";else throw new Error("ToasterId is required when using multiple toasters.");if(t.has(e))throw new Error(`Toaster with toasterId "${e}" already exists.`);if(t.size>0&&t.has("__default"))throw new Error("When using multiple toasters, all toasters must be provided with a unique toasterId.");return t.set(e,{toasterId:e,store:r,setStore:n,counter:o}),{toasterId:e,store:r,setStore:n,counter:o}}function Me(t,e){if(t.size===0)throw new Error("No toasters are currently registered. Please make sure that a toaster component has been rendered within the <ToastProvider> and registered properly.");if(!e){if(t.size===1)return Array.from(t.values())[0];throw new Error("When using multiple toasters, a toasterId must be included either in the useToast invocation or in the toast options if calling toast functions.")}let r=t.get(e);if(!r)throw new Error(`Toaster with toasterId "${e}" does not exist.`);return r}function xe(t,e){if(!t.has(e))throw new Error(`Toaster with toasterId "${e}" does not exist.`);t.delete(e);}var M={registerToaster:Ie,getToaster:Me,unregisterToaster:xe};function Pe(t,e){let r=(s,a)=>{e&&(a={toasterId:e,...a});let i=t.getToaster(a?.toasterId),{toasterId:u,store:l,setStore:w}=i,g=x(i.counter+=1,u,a?.id);E(g,l);let h=b(a),m=new I({store:l,setStore:w,toastConfig:{...h,contentType:typeof s=="function"?"dynamic":"static",content:s,id:g}});return m.init(),{id:g,ref:m.ref,progressControls:O(m)}},n=s=>{e&&(s={toasterId:e,...s});let{id:a,toasterId:i}=s,u=b(s);if(u.content&&(u.contentType=typeof u.content=="function"?"dynamic":"static"),!a&&!i){t.toasters.forEach(h=>{h.store.rendered.forEach(m=>m.update(u)),h.store.queued.forEach(m=>m.update(u));});return}let l=t.getToaster(i),{store:w}=l;if(i&&!a){l.store.rendered.forEach(h=>h.update(u)),l.store.queued.forEach(h=>h.update(u));return}let g=E(a,w);if(g)return g.update(u),{id:a,ref:g.ref,progressControls:O(g)}},o=s=>{if(e&&(s={toasterId:e,...s}),!s){t.toasters.forEach(i=>{i.store.rendered.forEach(u=>u.dismiss()),i.store.queued.forEach(u=>u.dismiss());});return}if(!s.toasterId&&!s.id&&s.keepQueued){t.toasters.forEach(i=>{i.store.rendered.forEach(u=>u.dismiss(s.reason));});return}let a=t.getToaster(s.toasterId);if(s.id){let i=E(s.id,a.store);i?.dismiss(s.reason);return}a.store.rendered.forEach(i=>i.dismiss(s.reason)),!s.keepQueued&&a.store.queued.forEach(i=>i.dismiss(s.reason));},f=s=>{if(e&&(s={toasterId:e,...s}),!s){t.toasters.forEach(i=>{batch(()=>{i.setStore("rendered",[]),i.setStore("queued",[]);});});return}if(!s.toasterId&&!s.id&&s.keepQueued){t.toasters.forEach(i=>{i.store.rendered.forEach(u=>u.remove());});return}let a=t.getToaster(s.toasterId);if(s.id){let i=E(s.id,a.store);if(!i)throw new Error(s.toasterId==="__default"?`Failed to remove toast: No toast found with the provided ID (${s.id}).`:`Failed to remove toast: No toast found with the provided ID (${s.id}) in the toaster with the toasterId "${s.toasterId}".`);i.remove();return}a.store.rendered.forEach(i=>i.remove()),!s.keepQueued&&a.store.queued.forEach(i=>i.remove());},d=(s,a,i)=>{e&&(i={toasterId:e,...i});let u=t.getToaster(i?.toasterId),l=b(i),w=x(u.counter+=1,i?.toasterId,i?.id),g=new I({store:u.store,setStore:u.setStore,toastConfig:{...l,id:w,type:"loading",duration:false,contentType:"static",content:a.pending}});return g.init(),new Promise((h,m)=>{s.then(T=>{g.update({type:"success",content:typeof a.success=="function"?a.success(T):a.success,contentType:"static",duration:i?.duration||u.store.toasterConfig.duration}),h(T);},T=>{g.update({type:"error",content:typeof a.error=="function"?a.error(T):a.error,contentType:"static",duration:i?.duration||u.store.toasterConfig.duration}),m(T);});})},c=(s=e)=>{let{store:a}=t.getToaster(s);return a.queued};return {notify:r,update:n,dismiss:o,remove:f,promise:d,getQueue:c,clearQueue:(s=e)=>{s||t.toasters.forEach(i=>{i.setStore("queued",[]);}),c(s).forEach(i=>i.remove());}}}var te=Pe;var re={theme:"light",type:"default",duration:5e3,onEnter:undefined,enterDuration:300,onExit:undefined,exitDuration:300,onIdle:undefined,positionY:"top",positionX:"right",offsetX:16,offsetY:16,gutter:16,limit:8,reverseToastOrder:false,pauseOnHover:true,pauseOnWindowInactive:true,renderOnWindowInactive:false,class:"sn-toast",style:undefined,wrapperClass:"sn-toast-wrapper",wrapperStyle:undefined,enterCallback:null,updateCallback:null,exitCallback:null,showDismissButton:true,dismissButtonStyle:undefined,dismissButtonClass:"sn-dismiss-button",dismissOnClick:false,toasterStyle:null,showProgressBar:true,progressBarStyle:undefined,progressBarClass:"sn-progress-bar",showIcon:true,icon:null,dragToDismiss:true,dragTreshold:100,ariaLive:"polite",role:"status"};var W=createContext();function oe(t){let e=new Map,r=mergeProps(re,splitProps(t,["children"])[1]);function n(d){return M.registerToaster(e,d)}function o(d){return M.getToaster(e,d)}function f(d){return M.unregisterToaster(e,d)}return onMount(()=>{typeof window>"u"||document.addEventListener("keydown",S);}),onCleanup(()=>{typeof window>"u"||document.removeEventListener("keydown",S);}),createComponent(W.Provider,{value:{providerProps:r,toasters:e,registerToaster:n,getToaster:o,unregisterToaster:f},get children(){return t.children}})}function se(){let t=useContext(W);if(!t)throw new Error("ServiceContext is not provided. Please wrap your component with <ToastProvider></ToastProvider>.");return {providerProps:t.providerProps,registerToaster:t.registerToaster,unregisterToaster:t.unregisterToaster,getToaster:t.getToaster}}function qe(t){let e=useContext(W);if(!e)throw new Error("ToastContext is not provided. Please wrap your component with <ToastProvider></ToastProvider>.");return te(e,t)}var Qe=template("<div class=sn-toaster>");function ae(t){let{registerToaster:e,unregisterToaster:r,providerProps:n}=se(),[o,f]=createStore({queued:[],rendered:[],toasterConfig:mergeProps(n,t),isWindowBlurred:typeof window<"u"&&document.visibilityState==="hidden"}),{toasterId:d}=e({toasterId:t.toasterId,store:o,setStore:f,counter:0});createEffect(on(()=>({...o.toasterConfig}),s=>[...o.queued,...o.rendered].forEach(a=>a.patch(s)))),createEffect(()=>{if(o.isWindowBlurred&&!o.toasterConfig.renderOnWindowInactive)return;if(o.toasterConfig.limit&&o.queued.length&&o.rendered.length<o.toasterConfig.limit){let[u,...l]=o.queued;batch(()=>{f("queued",l),f("rendered",[u,...o.rendered]);});}let a=o.toasterConfig.reverseToastOrder?[...o.rendered].reverse():o.rendered,i=o.toasterConfig.offsetY;a.forEach(u=>{if(u.ref){u.offset=i,i+=u.ref.clientHeight+o.toasterConfig.gutter;}});});let c=()=>{f("isWindowBlurred",true),o.toasterConfig.pauseOnWindowInactive&&o.rendered.forEach(s=>s.progressManager.pause());},v=()=>{f("isWindowBlurred",false),o.toasterConfig.pauseOnWindowInactive&&o.rendered.forEach(s=>{s.isPausedByUser||s.progressManager.play();});};return onMount(()=>{typeof window>"u"||(window.addEventListener("blur",c),window.addEventListener("focus",v));}),onCleanup(()=>{r(d),!(typeof window>"u")&&(window.removeEventListener("blur",c),window.removeEventListener("focus",v));}),(()=>{var s=Qe();return setAttribute(s,"id",d==="__default"?"sn-toaster":d),insert(s,createComponent(For,{get each(){return o.rendered},children:a=>a.render()})),effect(a=>style(s,{"justify-content":L(o.toasterConfig.positionX),...o.toasterConfig.toasterStyle},a)),s})()}
export{I as Toast,oe as ToastProvider,ae as Toaster,qe as useToast};